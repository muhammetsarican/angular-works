import { Injectable, signal, computed } from '@angular/core';

export type Language = 'en' | 'tr';

@Injectable({
  providedIn: 'root'
})
export class TranslationService {
  private currentLang = signal<Language>(this.getInitialLang());

  // Simple dictionary for now - in a real app, this would be in JSON files
  private translations: Record<Language, Record<string, string>> = {
    en: {
      WELCOME: 'WELCOME',
      DASHBOARD: 'DASHBOARD',
      PROTOCOLS: 'PROTOCOLS',
      NEURAL_LINK: 'NEURAL_LINK',
      IDENTITY_LINK: 'Identity_Link',
      NEURAL_SYNC: 'Neural_Sync',
      BIO_CLASSIFICATION: 'Bio_Classification',
      TERMINATE: 'Terminate',
      EXECUTE_LOGIN: 'Execute Login sequence',
      AWAITING_ID: 'Awaiting identification...',
      INPUT_PARAMS: 'Input parameters...',
      SELECT_PROTOCOL: 'Select Protocol',
      MALE: 'Protocol: MALE',
      FEMALE: 'Protocol: FEMALE',
      STATUS_READY: 'Status: READY',
      ACCESS_PROTOCOL: 'Access_Protocol',
      SEC_OVERRIDE: 'Security_Override_Active',
      LOG_HANDSHAKE: 'Handshake initiated...',
      LOG_SYNC: 'Protocol v2.1 synchronized',
      LOG_MEMLEAK: 'Memory leak detected (suppressed)',
      LOG_WAITING: 'Waiting for user interaction',
      LOG_CONN: 'Connection established',
      RETURN: 'Initialize_Return',
      ENCRYPTION: 'ENCRYPTION',
      RUNTIME: 'RUNTIME',
      STABLE: 'STABLE',
      NAV_HOME: 'HOME',
      NAV_TODO: 'TO-DO_LIST',
      NAV_AUTH: 'AUTH_GATE',
      NAV_SETTINGS: 'SETTINGS',
      SYSTEM_ARCH: 'SYSTEM_ARCH',
      APPEARANCE: 'APPEARANCE',
      LANGUAGE: 'LANGUAGE',
      APP_NAME: 'APP_NAME',
      APP_NAME_DESC: "Update your app's name.",
      APP_NAME_PLACEHOLDER: "Enter app's name...",
      SAVE: 'SAVE',
      APPEARANCE_DESC: 'Customize how the interface looks and feels.',
      DARK_MODE: 'Dark Mode',
      LANGUAGE_DESC: 'Select your preferred system language.',
      ENCRYPTION_DESC: 'Manage your account security and encryption keys.',
      MANAGE_SECURITY: 'Manage Security',
      RUNTIME_DESC: 'Configure advanced system runtime parameters.',
      PRODUCT_INVENTORY: 'Product Inventory',
      LINE_SECURE: 'Line_Secure',
      LATENCY: 'Latency',
      PROTOCOL_LOAD: 'Protocol_Load',
      SYSTEM_CORE: 'System_Core',
      SWITCH_LANGUAGE: 'Switch Neural_Language',
      TOGGLE_THEME: 'Toggle Neuro-Theme',
      LOGOUT: 'LOGOUT',
      TASKS_MATRIX: 'Tasks_Matrix',
      SEARCH_REGISTRY: 'Search_Registry',
      SCAN_KEYWORDS: 'SCAN_FOR_KEYWORDS...',
      INIT_NEW_TASK: 'Initializing_New_Task',
      ABORT_OP: 'Abort_Operation',
      EXECUTE_COMMIT: 'Execute_Commit',
      UPDATE_TASK_PARAMS: 'Updating_Task_Parameters',
      ABORT_UPDATE: 'Abort_Update',
      APPLY_PARAMS: 'Apply_Parameters',
      TASK_ID: 'Task_Identifier',
      PRIORITY_LEVEL: 'Priority_Level',
      CORE_DIRECTIVES: 'Core_Directives',
      RECURSIVE_PROTOCOL: 'Recursive_Protocol (Monthly)',
      LOW: 'Low',
      MEDIUM: 'Medium',
      HIGH: 'High',
      UNDEFINED: 'UNDEFINED',
      DIRECTIVES_PLACEHOLDER: 'Enter task parameters...',
      PRIORITY: 'Priority',
      STATUS_DONE: 'Done',
      STATUS_ACTIVE: 'Active',
      STATUS_PENDING: 'Pending',
      EDIT_TASK: 'Edit Task',
      DELETE_TASK: 'Delete Task',
      APPEND_NEW_TASK: 'Append_New_Task',
      CONFIRM_LOGOUT_MSG: 'Dear {{name}}, do you want to logout?',
      CONFIRM_TITLE: 'Confirm Operation',
      ABORT_ACTION: 'Abort_Action',
      NODE: 'Node',
      LOCAL_AUTH: 'Local_Auth',
      CURRENT_IDENTITY: 'Current_Identity',
      AUTH_TOKEN: 'Auth_Token',
      PROTOCOL_ID_OVERRIDE: 'Protocol_Identity_Override',
      ENTER_IDENTITY: 'Enter Identity...',
      ENTER_PASSWORD: 'Enter Password...',
      LOGIN_BTN: 'Login',
      INIT_RETURN: 'Initialize_Return',
      CONFIG_OVERRIDE: 'Config_Override',
      STREAM_ANALYTICS: 'Stream_Analytics',
      SYSTEM_LOGS: 'System_Logs',
      AUTH_SYSTEM_ONLINE: 'Unit_Auth_System_Online'
    },
    tr: {
      WELCOME: 'HOŞ GELDİNİZ',
      DASHBOARD: 'PANEL',
      PROTOCOLS: 'PROTOKOLLER',
      NEURAL_LINK: 'NÖRAL_BAĞ',
      IDENTITY_LINK: 'Kimlik_Bağı',
      NEURAL_SYNC: 'Nöral_Senkronizasyon',
      BIO_CLASSIFICATION: 'Biyo_Sınıflandırma',
      TERMINATE: 'Sonlandır',
      EXECUTE_LOGIN: 'Giriş dizisini çalıştır',
      AWAITING_ID: 'Kimlik bekleniyor...',
      INPUT_PARAMS: 'Giriş parametreleri...',
      SELECT_PROTOCOL: 'Protokol Seçin',
      MALE: 'Protokol: ERKEK',
      FEMALE: 'Protokol: KADIN',
      STATUS_READY: 'Durum: HAZIR',
      ACCESS_PROTOCOL: 'Erişim_Protokolü',
      SEC_OVERRIDE: 'Güvenlik_Geçersiz_Kılma_Aktif',
      LOG_HANDSHAKE: 'El sıkışma başlatıldı...',
      LOG_SYNC: 'Protokol v2.1 senkronize edildi',
      LOG_MEMLEAK: 'Bellek sızıntısı tespit edildi (engellendi)',
      LOG_WAITING: 'Kullanıcı etkileşimi bekleniyor',
      LOG_CONN: 'Bağlantı kuruldu',
      RETURN: 'Geri_Dönüşü_Başlat',
      ENCRYPTION: 'ŞİFRELEME',
      RUNTIME: 'ÇALIŞMA_ZAMANI',
      STABLE: 'KARARLI',
      NAV_HOME: 'ANA_SAYFA',
      NAV_TODO: 'YAPILACAKLAR',
      NAV_AUTH: 'YETKİ_KAPISI',
      NAV_SETTINGS: 'AYARLAR',
      SYSTEM_ARCH: 'SİSTEM_MİMARİSİ',
      APPEARANCE: 'GÖRÜNÜM',
      LANGUAGE: 'DİL',
      APP_NAME: 'UYGULAMA_ADI',
      APP_NAME_DESC: 'Uygulamanızın adını güncelleyin.',
      APP_NAME_PLACEHOLDER: 'Uygulama adını girin...',
      SAVE: 'KAYDET',
      APPEARANCE_DESC: 'Arayüzün görünümünü ve hissini özelleştirin.',
      DARK_MODE: 'Karanlık Mod',
      LANGUAGE_DESC: 'Tercih ettiğiniz sistem dilini seçin.',
      ENCRYPTION_DESC: 'Hesap güvenliğinizi ve şifreleme anahtarlarınızı yönetin.',
      MANAGE_SECURITY: 'Güvenliği Yönet',
      RUNTIME_DESC: 'Gelişmiş sistem çalışma zamanı parametrelerini yapılandırın.',
      PRODUCT_INVENTORY: 'Ürün Envanteri',
      LINE_SECURE: 'Hat_Güvenli',
      LATENCY: 'Gecikme',
      PROTOCOL_LOAD: 'Protokol_Yükü',
      SYSTEM_CORE: 'Sistem_Çekirdeği',
      SWITCH_LANGUAGE: 'Nöral_Dili_Değiştir',
      TOGGLE_THEME: 'Nöro-Temayı_Değiştir',
      LOGOUT: 'ÇIKIŞ_YAP',
      TASKS_MATRIX: 'Görev_Matrisi',
      SEARCH_REGISTRY: 'Arama_Kaydı',
      SCAN_KEYWORDS: 'ANAHTAR_KELİME_TARA...',
      INIT_NEW_TASK: 'Yeni_Görev_Başlatılıyor',
      ABORT_OP: 'İşlemi_İptal_Et',
      EXECUTE_COMMIT: 'Yürütmeyi_Onayla',
      UPDATE_TASK_PARAMS: 'Görev_Parametreleri_Güncelleniyor',
      ABORT_UPDATE: 'Güncellemeyi_İptal_Et',
      APPLY_PARAMS: 'Parametreleri_Uygula',
      TASK_ID: 'Görev_Tanımlayıcı',
      PRIORITY_LEVEL: 'Öncelik_Seviyesi',
      CORE_DIRECTIVES: 'Çekirdek_Yönergeler',
      RECURSIVE_PROTOCOL: 'Yinelemeli_Protokol (Aylık)',
      LOW: 'Düşük',
      MEDIUM: 'Orta',
      HIGH: 'Yüksek',
      UNDEFINED: 'TANIMSIZ',
      DIRECTIVES_PLACEHOLDER: 'Görev parametrelerini girin...',
      PRIORITY: 'Öncelik',
      STATUS_DONE: 'Tamamlandı',
      STATUS_ACTIVE: 'Aktif',
      STATUS_PENDING: 'Beklemede',
      EDIT_TASK: 'Görevi Düzenle',
      DELETE_TASK: 'Görevi Sil',
      APPEND_NEW_TASK: 'Yeni_Görev_Ekle',
      CONFIRM_LOGOUT_MSG: 'Sayın {{name}}, çıkış yapmak istiyor musunuz?',
      CONFIRM_TITLE: 'İşlemi Onayla',
      ABORT_ACTION: 'Eylemi_İptal_Et',
      NODE: 'Düğüm',
      LOCAL_AUTH: 'Yerel_Yetki',
      CURRENT_IDENTITY: 'Mevcut_Kimlik',
      AUTH_TOKEN: 'Yetki_Belgesi',
      PROTOCOL_ID_OVERRIDE: 'Protokol_Kimlik_Geçersiz_Kılma',
      ENTER_IDENTITY: 'Kimlik girin...',
      ENTER_PASSWORD: 'Şifre girin...',
      LOGIN_BTN: 'Giriş Yap',
      INIT_RETURN: 'Geri_Dönüşü_Başlat',
      CONFIG_OVERRIDE: 'Yapılandırma_Geçersiz_Kılma',
      STREAM_ANALYTICS: 'Akış_Analizi',
      SYSTEM_LOGS: 'Sistem_Günlükleri',
      AUTH_SYSTEM_ONLINE: 'Birim_Yetkilendirme_Sistemi_Çevrimiçi'
    }
  };

  lang = computed(() => this.currentLang());

  translate(key: string): string {
    return this.translations[this.currentLang()][key] || key;
  }

  translateWithParams(key: string, params: Record<string, string>): string {
    let translation = this.translate(key);
    Object.keys(params).forEach(param => {
      translation = translation.replace(`{{${param}}}`, params[param]);
    });
    return translation;
  }

  setLanguage(lang: Language) {
    this.currentLang.set(lang);
    localStorage.setItem('lang', lang);
  }

  private getInitialLang(): Language {
    const saved = localStorage.getItem('lang') as Language;
    if (saved === 'en' || saved === 'tr') return saved;
    return 'en';
  }
}
